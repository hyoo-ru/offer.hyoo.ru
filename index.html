<!doctype html>
<html mol_view_root>

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1">
<meta http-equiv="X-Prerender-Token" content="NYgGNkJ75zsaToxx7aEO">
<meta name="fragment" content="!">
<link href="mol/logo/logo.svg" rel="icon" />

<link href="web.css" rel="stylesheet"/>

<body mol_view_root>

<div mol_view_root="$hyoo_offer">
  <script>
    window.onerror = function(a,b,c) { alert( a+' '+b+' '+c ) }
    window.onload = function(){ window.onerror = null }
// P2P
const run = async ()=> {

	// peer 1
	console.log( 'o' )
	const con1 = new RTCPeerConnection
	console.log( 'x' )
	const chan1 = con1.createDataChannel( 'xxx', { negotiated : true, id: 1 } )
	console.log( 'xx' )
	await con1.setLocalDescription()
	console.log( 'xxx' )
	con1.onicecandidateerror = console.error
	//await new Promise( done => con1.onicecandidate = ({ candidate })=> done( candidate ) )
	const sdp1 = con1.localDescription.sdp
	console.log( sdp1 )

	// peer 2 receives offer around p2p
	const con2 = new RTCPeerConnection
	const chan2 = con2.createDataChannel( 'xxx', { negotiated : true, id: 1 } )
	chan2.addEventListener( 'message', console.log )
	await con2.setRemoteDescription( con1.localDescription )
	await con2.setLocalDescription()
	//await new Promise( done => con2.onicecandidate = ({ candidate })=> done( candidate ) )
	const sdp2 = con2.localDescription.sdp
	console.log( sdp2 )

	// peer 1 receives answer around p2p
	await con1.setRemoteDescription( con2.localDescription )
	await new Promise( done => chan1.onopen = done )
	chan1.send( 'xxx' )

}
run()
  </script>
<script src="web.js" charset="utf-8"></script>
